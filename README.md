# Sanic ecommerce API

## Эндпойнты

### `[POST] /api/signup`

Структура тела запроса: 
``` python
{
    username: str
    password1: str
    password2: str
}
```

Регистрация пользователя.  Ответом на запрос является ссылка, на которую нужно отравить GET-запрос для активации этой учетной записи. При регистрации пользователя с `username = "admin"`, эта учетная запись активируется автоматически и наделяется правами администратора.


&emsp;


### `[POST] /api/signin`

Структура тела запроса:
``` python
{
    username: str
    password: str
}
```

JWT-авторизация пользователя для входа в систему. Если учетная запись не активирована, доступ будет запрещен. Ответом на запрос является JWT-токен.


&emsp;


### `[POST] /api/products`

Структура тела запроса:
``` python
{
    name: str
    description: str
    price: Decimal
}
```

Добавление модели товара в систему. Доступен только для администраторов.


&emsp;


### `[GET] /api/products`

Получения списка моделей товаров в системе. Доступен для авторизованных пользователей.


&emsp;


### `[GET] /api/products/<product_id:uuid>`

Получения модели товара по его ID. Доступен для авторизованных пользователей.


&emsp;


### `[PUT] /api/products/<product_id:uuid>`

Структура тела запроса:
``` python
{
    name: str
    description: str
    price: Decimal
}
```

Полное изменение модели товара. Если товар с заданным ID не найден, будет создан новый товар с заданным ID. Доступен только для администраторов.


&emsp;


### `[PATCH] /api/products/<product_id:uuid>`

Структура тела запроса:
``` python
{
    name: typing.Optional[str] = None
    description: typing.Optional[str] = None
    price: typing.Optional[Decimal] = None
}
```

Частичное изменение модели (изменение отдельных полей модели) товара с заданным ID. Доступен только для администраторов.


&emsp;


### `[DELETE] /api/products/<product_id:uuid>`

Удаление модели товара с заданным ID. Доступен только для администраторов. 


&emsp;


### `[POST] /api/bills`

Создание модели счета в системе для пользователя. Доступен для авторизованных пользователей.


&emsp;


### `[GET] /api/bills`

Получение списка счетов пользователя. Доступен для авторизованных пользователей.


&emsp;


### `[POST] /api/transactions`

Структура тела запроса:
``` python
{
    bill_id: UUID
    amount: Decimal
}
```

Создание модели транзакции пользователя на заданный в теле счет. По заданному правилу формируется сигнатура и отправляется POST-запрос на `/api/payment/webhook`, где сигнатура формируется заново. Если сигнатуры совпадают, транзакция подтверждается, происходит зачисление средств на счет. Доступен для авторизованных пользователей.


&emsp;


### `[GET] /api/transactions`

Получение списка транзакций пользователя. Доступен для авторизованных пользователей.


&emsp;


### `[POST] /api/payment/webhook`

Структура тела запроса:
``` python
{
    signature: str
    bill_id: UUID
    transaction_id: UUID
    user_id: UUID
    amount: Decimal
}
```

Подтвержение транзакции. При запросе сигнатура формируется заново и сравнивается с пришедшей в теле. Если они совпадают, транзакция подтверждается, происходит начисление на счет. Если совпадения нет, транзакция остается в системе с нулевой суммой.


&emsp;


### `[POST] /api/payment`

Структура тела запроса:
``` python
{
    product_id: UUID
    bill_id: UUID
}
```

Покупка товара пользователем. С указанного счета (он должен принадлежать пользователю) списывается стоимость товара, если на счете достаточно средств. Доступен для авторизованных пользователей.


&emsp;


### `[GET] /api/users/`

Получение списка пользователей зарегистрированных в системе. Доступен только для администраторов. 


&emsp;


### `[GET] /api/users/<user_id:uuid>`

Получение модели пользователя с заданным ID. Доступен только для администраторов.


&emsp;


### `[PATCH] /api/users/<user_id:uuid>`

Структура тела запроса:
``` python
{
    is_active: Optional[bool] = None
    is_admin: Optional[bool] = None
}
```

Активация и назначение администратором пользователя с заданным ID. Доступен только для администраторов.


&emsp;


### `[GET] /api/users/<user_id:uuid>/bills`

Получение списка счетов пользователя с заданным ID. Доступен только для администраторов.


&emsp;


### `[GET] /api/users/<user_id:uuid>/transactions`

Получение списка транзакций пользователя с заданным ID. Доступен только для администраторов.
